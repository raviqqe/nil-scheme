#!/bin/sh

set -e

directory=$(dirname $0)/../../..

interpret() {
  if [ $STAK_HOST_INTERPRETER = stak ]; then
    stak-interpret "$@"
  else
    $STAK_HOST_INTERPRETER $directory/compile.scm
  fi
}

export PATH=$directory/target/release:$PATH

cat $directory/prelude.scm "$@" | stak-compile >main.out
stak-decode <main.out >/dev/null
stak-interpret main.out
